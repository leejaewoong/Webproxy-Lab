<!Doctype html>
<html lang="ko">

    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">        

	    <!-- JS -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
            integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
            crossorigin="anonymous">

        <!-- 구글폰트 -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&family=Noto+Serif+KR:wght@200..900&display=swap" rel="stylesheet">

        <!-- 아이콘 -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">


        <title>크래프톤 정글 | 나홀로 메모장</title>

        <!-- style -->
        <style type="text/css">
            * {
                font-family: "Noto Serif KR", serif;
            }        
            .wrap {
                width: 70%;
                margin: auto;
            }                
            .card {
                padding: 20px;
            }
            .link-like {
                float: right;
            }
            
        </style>
        <script>
            $(document).ready(function () {
                $("#card-list").empty();
                showMemo();
            });         
            
            function postMemo() {
                let title = $('#memo-title').val() 
                let content = $('#memo-content').val()
                $.ajax({
                    type: "POST",
                    url: "/memo",
                    data: {'title':title, 'content':content},
                    success: function (response) { 
                        if (response["result"] == "success") {
                            alert("포스팅 성공!");                            
                            window.location.reload();
                        }
                    }
                })
            }
            
            function showMemo() {
                $.ajax({
                    type: "GET",
                    url: "/memo",
                    data: {},
                    success: function (response) {
                        if (response["result"] == "success") {                            
                            let memo = response['data'];
                            console.log(memo);
                            $("#card-list").empty();
                            for (let i = 0; i < memo.length; i++) {
                                let id = memo[i]['_id'];
                                console.log(id);
                                let title = memo[i]['title'];
                                console.log(title);
                                let content = memo[i]['content'];
                                console.log(content);
                                let likes = memo[i]['likes'];
                                console.log(likes);
                                let status = 'normal'
                                card = `<div id='card-${id}' class="card">                    
                                            <p class="card-title">${title}</p>
                                            <p class="card-text">${content}</p>
                                            <p class="card-likes">${likes}</p>
                                            <button onclick="editMode('${id}', '${status}', '${title}', '${content}')" class="btn btn-info edit-button">수정</button>
                                            <button onclick="removeMemo('${id}')" class="btn btn-danger delete-button">삭제</button>
                                            <button onclick="likes('${id}')" class="btn btn-link link-like">
                                                <i class="fa-regular fa-thumbs-up fa-lg"></i>
                                            </button>                    
                                        </div>`
                                $('#card-list').append(card)
                            }                                                                                                      
                        }
                    }
                })
            }

            function editMode(id, status, title, content) {
                if (status == 'normal') {
                    console.log(id, status, title, content)
                    
                    $(`#card-${id}`).empty();
                    edit = `
                            <p><input id="memo-title" type="text" class="form-control new-title"
                                style="width:100%; margin-top:10px;"></p>                
                            <p><textarea id="memo-content" class="form-control new-text"
                                style="width:100%; margin-bottom: 10px;"></textarea></textarea></p>                                           
                            <button class="btn btn-success save-button">저장</button>
                           `
                    $(`#card-${id}`).append(edit)                    
                    $(`#card-${id} .new-title`).val(title)    
                    $(`#card-${id} .new-text`).val(content)                                     
                    $(`#card-${id} .save-button`).on("click", function() {
                        let newTitle = $(`#card-${id} .new-title`).val();
                        let newContent = $(`#card-${id} .new-text`).val();
                        editMemo(id, newTitle, newContent)
                    })
                }
            }
            
            
            function editMemo(id, newTitle, newContent) {                
                $.ajax({
                    type: "POST",
                    url: "/edit",
                    data: {'id':id, 'title':newTitle, 'content':newContent},
                    success: function (response) { 
                        console.log(id, newTitle, newContent)
                        if (response["result"] == "success") {
                            alert("수정 완료!");                            
                            showMemo()
                        }
                    }
                })
            }            

            function removeMemo(id) {                
                $.ajax({
                    type: "POST",
                    url: "/remove",
                    data: {'id':id},
                    success: function (response) { 
                        if (response["result"] == "success") {
                            alert("삭제 완료!");                            
                            showMemo()
                        }
                    }
                })
            }  
            
            function likes(id) {                
                $.ajax({
                    type: "POST",
                    url: "/likes",
                    data: {'id':id},
                    success: function (response) { 
                        if (response["result"] == "success") {                            
                            showMemo()
                        }
                    }
                })
            }  
        </script>

    </head>

    <body>
        <div class="wrap">
            <div class="jumbotron">
                <h1>나홀로 메모장 <span style="background-color:darkgray; color:white">ver2.0</span></h1>                                           
                <p><input id="memo-title" type="text" class="form-control" placeholder="제목을 입력하세요" 
                    style="width:60%; margin-top:30px;"></p>                
                <p><textarea id="memo-content" class="form-control" placeholder="내용을 입력하세요"
                    style="width:60%; margin-bottom: 10px;"></textarea></textarea></p>                
                <button onclick="postMemo()" type="submit" class="btn btn-primary">저장하기</button>
            </div>            
            <div id="card-list" class="card-columns">
                                                
            </div>
        </div>
    </body>

</html>